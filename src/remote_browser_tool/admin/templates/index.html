{% extends "layout.html" %}
{% block content %}
<div class="card">
  <h2>Connect an Executor</h2>
  {% if error_message %}
    <div class="alert error">{{ error_message }}</div>
  {% endif %}
  <form method="post" action="/executors" class="form-grid">
    <div class="form-row">
      <label for="label">Label</label>
      <input id="label" name="label" type="text" placeholder="Optional friendly name" />
    </div>
    <div class="form-row">
      <label for="base_url">Executor URL</label>
      <input
        id="base_url"
        name="base_url"
        type="text"
        placeholder="executor-host:9001"
        required
      />
    </div>
    <div class="form-actions">
      <button type="submit">Add executor</button>
    </div>
  </form>
  <p class="hint">Executors can run on any host that the admin service can reach over HTTP.</p>
</div>
<div class="card">
  <h2>Executor Status</h2>
  {% if executors|length == 0 %}
    <p>No executor endpoints configured yet. Use the form above to connect one.</p>
  {% else %}
    <table>
      <thead>
        <tr>
          <th>Executor</th>
          <th>Browser</th>
          <th>LLM</th>
          <th>Overrides</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in executors %}
          <tr>
            <td>
              <div>{{ item.endpoint.label }}</div>
              <div class="muted">{{ item.endpoint.base_url }}</div>
            </td>
            <td>
              {% if item.error %}
                <span class="status-pill status-unknown">Unavailable</span>
              {% elif item.health %}
                <span class="status-pill {{ status_class(item.health.browser.status) }}">
                  {{ item.health.browser.status|capitalize }}
                </span>
                {% if item.health.browser.detail %}<div>{{ item.health.browser.detail }}</div>{% endif %}
              {% else %}
                <span class="status-pill status-unknown">Unknown</span>
              {% endif %}
            </td>
            <td>
              {% if item.health %}
                <span class="status-pill {{ status_class(item.health.llm.status) }}">
                  {{ item.health.llm.status|replace('_', ' ')|capitalize }}
                </span>
                {% if item.health.llm.provider %}<div>Provider: {{ item.health.llm.provider }}</div>{% endif %}
              {% elif item.error %}
                <span class="status-pill status-unknown">Unavailable</span>
              {% else %}
                <span class="status-pill status-unknown">Unknown</span>
              {% endif %}
            </td>
            <td>
              {% if item.health %}
                {{ item.health.env_overrides|length }} keys
              {% else %}
                â€”
              {% endif %}
          </td>
          <td>
            <div class="table-actions">
              <a href="/executors/{{ item.endpoint.key }}">Open</a>
              <form
                method="post"
                action="/executors/{{ item.endpoint.key }}/delete"
                class="inline-form"
              >
                <button type="submit" class="danger">Remove</button>
              </form>
            </div>
            {% if item.error %}<div class="error">{{ item.error }}</div>{% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endblock %}
